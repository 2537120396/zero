$("[contenteditable]").each(function(){try{document.execCommand("AutoUrlDetect",false,false)}catch(e){}$(this).on("paste",function(e){e.preventDefault();var text=null;if(window.clipboardData&&clipboardData.setData){text=window.clipboardData.getData("text")}else{text=(e.originalEvent||e).clipboardData.getData("text/plain")||prompt("在这里输入文本")}if(document.body.createTextRange){if(document.selection){textRange=document.selection.createRange()}else{if(window.getSelection){sel=window.getSelection();var range=sel.getRangeAt(0);var tempEl=document.createElement("span");tempEl.innerHTML="&#FEFF;";range.deleteContents();range.insertNode(tempEl);textRange=document.body.createTextRange();textRange.moveToElementText(tempEl);tempEl.parentNode.removeChild(tempEl)}}textRange.text=text;textRange.collapse(false);textRange.select()}else{document.execCommand("insertText",false,text)}})});function Emoji(option){this.emoji=option.emojiArray}Emoji.prototype={init:function(){this.toEmoji();this.loadEmoji();this.bindEvent()},toEmoji:function(){var key="\\01|02|03|04|05|06|07|08|09|10|11|12|13|14|15|16|17|18|19|20|21|22|23|24|25|26|27|28|29|30|31|32|33|34|35|36|37|38|39|40|41|42|43|44|45|46|47|48|49|50";var regex=new RegExp(":("+key+"):","g"),obj=$("#content"),len=obj.length,i;for(i=0;i<len;i++){$(obj[i]).html($(obj[i]).html().replace(regex,emoji))}function emoji(){var k=argument[1];return'<img class="emoji emoji_'+k+' small" />'}},loadEmoji:function(){var emoji=[],i,data=this.emoji,len=data.length,emojiBox=$("#emojiBox");for(i=0;i<len;i++){emoji.push('<img class="emoji emoji_'+data[i]+' small" />')}$("#emojiBox").html(emoji.join(""))},bindEvent:function(){var _this=this;var emojiBox=$("#emojiBox");$("#emojiBox img").click(function(){var text=$("#content");$(this).clone().appendTo(text);text.fous()});emojiBox.hover(function(){},function(){emojiBox.addClass("hide")});$("#load").click(function(e){if(emojiBox.hasClass("hide")){emojiBox.removeClass("hide")}else{emojiBox.addClass("hide")}e.stopPropagation()})}};window.Emoji=Emoji;if($("#commpic").length==0){var input=$('<input type="file" id="commpic" name="pho[]" accept="image/*" onchange="change(this);"/>');$("#fileDiv").append(input)}$(window).resize(function(){if($("#copic").children("img").length!=0){if($(window).width()<=760){$("#copic img").css({"max-width":"85px","max-height":"85px"})}else{$("#copic img").css({"max-width":"200px","max-height":"200px"})}}});$("#upload").click(function(){if($("#commpic").length!=0){$("#commpic").click()}});var len=$("#fileDiv").children().length-1;function change(file){function pic(){$("#commpic").removeAttr("id");var input='<input id="commpic" type="file" name="pho[]" accept="image/*" onchange="change(this);"/>';$("#fileDiv").append(input);if($("#fileDiv").children().length>5){$($("#fileDiv").find("input")[0].remove())}if($("#copic").children("img").length>=3){$($("#copic").find("img")[0].remove())}$("#copic").append(img)}if(file.files&&file.files[0]){if(typeof FileReader=="undefined"){alert("你的浏览器不支持FileReader接口,不能上传图片!");return false}var reader=new FileReader();reader.onload=function(evt){if($(window).width()<=760){img=$('<img src="'+evt.target.result+'" class="img-responsive" style=max-width:85px;max-height:85px;">')}else{img=$('<img src="'+evt.target.result+'" class="img-responsive" style=max-width:200px;max-height:200px;">')}pic()};reader.readAsDataURL(file.files[0])}else{img=$('<div class="img" style="filter:progid:DXImageTransform.Microsoft.AlphaImageLoader(sizingMethod=scale,src=\''+file.value+"'\"></div>");pic()}}$("#sub").click(function(){var comment=$("#content").html();$("textarea[name='content']").html(comment);$("#hsub").click()});$("#emojiBox").click(function(e){e.stopPropagation()});